From: Sergio Durigan Junior <sergio.durigan@canonical.com>
Date: Mon, 29 Jun 2020 17:39:01 -0400
Subject: Don't wire the library name into pcap-config.

With autotools, set the package name with AC_INIT(), which now takes the
package name and version as arguments, rather than the name of a file in
the source directory.  That sets PACKAGE_NAME.

With CMake, set PACKAGE_NAME to ${LIBRARY_NAME}.

In pcap-config.in, use "-l@PACKAGE_NAME@", rather than -lpcap, as the
library name.

That means that pcap-config will use -lwpcap, rather than -lpcap, on
Windows, where the library's name is wpcap rather than just pcap.

Author: Guy Harris <guy@alum.mit.edu>
Origin: backport, https://github.com/the-tcpdump-group/libpcap/commit/c2e151358d7bc7c77dddb4ca00770034872cd081
Bug-Ubuntu: https://bugs.launchpad.net/ubuntu/+source/libpcap/+bug/1865501
Reviewed-By: Sergio Durigan Junior <sergio.durigan@canonical.com>
Last-Update: 2020-06-29
---
 configure      | 31 ++++++++++++++++---------------
 configure.ac   |  3 ++-
 pcap-config.in |  5 +++--
 3 files changed, 21 insertions(+), 18 deletions(-)

diff --git a/configure b/configure
index 4c64875..fd14f5f 100755
--- a/configure
+++ b/configure
@@ -1,6 +1,6 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.69.
+# Generated by GNU Autoconf 2.69 for pcap 1.8.1.
 #
 #
 # Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
@@ -575,14 +575,13 @@ MFLAGS=
 MAKEFLAGS=
 
 # Identity of this package.
-PACKAGE_NAME=
-PACKAGE_TARNAME=
-PACKAGE_VERSION=
-PACKAGE_STRING=
-PACKAGE_BUGREPORT=
-PACKAGE_URL=
-
-ac_unique_file="pcap.c"
+PACKAGE_NAME='pcap'
+PACKAGE_TARNAME='pcap'
+PACKAGE_VERSION='1.8.1'
+PACKAGE_STRING='pcap 1.8.1'
+PACKAGE_BUGREPORT=''
+PACKAGE_URL=''
+
 # Factoring default headers for most tests.
 ac_includes_default="\
 #include <stdio.h>
@@ -803,7 +802,7 @@ sharedstatedir='${prefix}/com'
 localstatedir='${prefix}/var'
 includedir='${prefix}/include'
 oldincludedir='/usr/include'
-docdir='${datarootdir}/doc/${PACKAGE}'
+docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'
 infodir='${datarootdir}/info'
 htmldir='${docdir}'
 dvidir='${docdir}'
@@ -1303,7 +1302,7 @@ if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures this package to adapt to many kinds of systems.
+\`configure' configures pcap 1.8.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1351,7 +1350,7 @@ Fine tuning of the installation directories:
   --infodir=DIR           info documentation [DATAROOTDIR/info]
   --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
   --mandir=DIR            man documentation [DATAROOTDIR/man]
-  --docdir=DIR            documentation root [DATAROOTDIR/doc/PACKAGE]
+  --docdir=DIR            documentation root [DATAROOTDIR/doc/pcap]
   --htmldir=DIR           html documentation [DOCDIR]
   --dvidir=DIR            dvi documentation [DOCDIR]
   --pdfdir=DIR            pdf documentation [DOCDIR]
@@ -1368,7 +1367,9 @@ _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
-
+  case $ac_init_help in
+     short | recursive ) echo "Configuration of pcap 1.8.1:";;
+   esac
   cat <<\_ACEOF
 
 Optional Features:
@@ -1500,7 +1501,7 @@ fi
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-configure
+pcap configure 1.8.1
 generated by GNU Autoconf 2.69
 
 Copyright (C) 2012 Free Software Foundation, Inc.
@@ -1965,7 +1966,7 @@ cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by $as_me, which was
+It was created by pcap $as_me 1.8.1, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
diff --git a/configure.ac b/configure.ac
index 46bbd67..9952e04 100644
--- a/configure.ac
+++ b/configure.ac
@@ -15,7 +15,8 @@ dnl
 #
 
 AC_PREREQ(2.61)
-AC_INIT(pcap.c)
+AC_INIT(pcap, 1.8.1)
+AC_SUBST(PACKAGE_NAME)
 
 AC_CANONICAL_SYSTEM
 
diff --git a/pcap-config.in b/pcap-config.in
index 16522dd..945c52d 100644
--- a/pcap-config.in
+++ b/pcap-config.in
@@ -8,6 +8,7 @@ prefix="@prefix@"
 exec_prefix="@exec_prefix@"
 includedir="@includedir@"
 LIBS="@LIBS@"
+PACKAGE_NAME="@PACKAGE_NAME@"
 
 static=0
 show_cflags=0
@@ -63,7 +64,7 @@ else
 	#
 	if [ "$show_cflags" = 1 -a "$show_libs" = 1 ]
 	then
-		echo "-I$includedir -lpcap"
+		echo "-I$includedir -l$PACKAGE_NAME"
 	elif [ "$show_cflags" = 1 -a "$show_additional_libs" = 1 ]
 	then
 		echo "-I$includedir"
@@ -72,6 +73,6 @@ else
 		echo "-I$includedir"
 	elif [ "$show_libs" = 1 ]
 	then
-		echo "-lpcap"
+		echo "-l$PACKAGE_NAME"
 	fi
 fi
